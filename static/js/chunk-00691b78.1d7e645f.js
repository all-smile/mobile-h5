(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-00691b78"],{"24eb":function(e,t,n){},"4ee0":function(e,t,n){"use strict";n("24eb")},aaa8:function(e,t,n){"use strict";n.r(t);var i=n("1da1"),o=(n("96cf"),n("a15b"),n("caad"),n("eee4"));function c(){var e=[0,1,Math.floor(4*Math.random()+2)],t=3,n=new Array(t),i=e.length,o=new Array(i);if(i<t)throw new RangeError("getrandom: more elements taken than available");for(;t--;){var c=Math.floor(Math.random()*i);n[t]=e[c in o?o[c]:c],o[c]=--i in o?o[i]:i}return n}var r={name:"FaceVerify",props:{},components:{},data:function(){return{tip:"",currentColorIdx:-1,currentColorValue:"transparent",actionIndex:0,bdFaceLiveDetection:null,image:"",isSupported:o.default.isSupport(),query:{actionNumber:3,code:c().join(""),threshold:.8,isAction:!0},timer:null,risk:null,action:""}},computed:{colorRunning:function(){return-1!==this.currentColorIdx}},watch:{},created:function(){this.$toast.clear()},mounted:function(){var e=this;this.isSupported?this.$nextTick((function(){e.init(e.query)})):(this.tip="该浏览器不支持",this.deviceTip())},methods:{deviceTip:function(){this.$dialog.confirm({message:this.tip,showCancelButton:!1}).then((function(){})).catch((function(){}))},init:function(e){var t=this;return Object(i.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.bdFaceLiveDetection=new o.default({video:"face-live-detection-video",solutionType:2,code:e.code,randomMotionDetection:!1,needToRecord:!1,timeout:15e3,useSecure:!0,constraints:{video:{width:{min:320,ideal:320,max:320},height:{min:240,ideal:240,max:240}},audio:!1},isOriginImage:!1,modelPath:".",autoloadModels:!1,vbox:[216,216],leftYaw:15,rightYaw:15,occlusion:{eye:.8,mouse:.8,nose:.8,leftFace:.8,rightFace:.8,chin:.8}}),t.bindEvents(),n.next=5,t.bdFaceLiveDetection.start();case 5:t.bdFaceLiveDetection.loadModels();case 6:case"end":return n.stop()}}),n)})))()},bindEvents:function(){var e=this;this.bdFaceLiveDetection.on("camera_open",(function(){e.tip="摄像头即将开启，请平视并正对屏幕"})),this.bdFaceLiveDetection.on("status",(function(e){})),this.bdFaceLiveDetection.on("detection:colorfinished",(function(){})),this.bdFaceLiveDetection.on("detection:silencefinished",(function(){})),this.bdFaceLiveDetection.on("detection:actionfinished",(function(){})),this.bdFaceLiveDetection.on("action",(function(t){e.actionIndex=t})),this.bdFaceLiveDetection.on("tip",(function(t){var n=t.code;t=t.text;"action_over"!==n&&(["blink","lookup","lookdown","mouthopen","headleft","headright"].includes(n)&&(e.action=n+"2"),e.tip=void 0===t?"请平视并正对屏幕":t)})),this.bdFaceLiveDetection.on("color",(function(t,n){e.currentColorIdx=t,e.currentColorValue=n})),this.bdFaceLiveDetection.on("success",(function(t){e.tip="检测完成，正在进行系统验证",e.$toast.loading({message:"系统验证中",forbidClick:!1,loadingType:"spinner",duration:0}),t.face&&(t={face:t.face,jr:t.jr},e.fetchFaceSec(t))})),this.bdFaceLiveDetection.on("fail",(function(t){switch(t=t[0],t){case"timeout":e.timer&&clearTimeout(e.timer),e.timer=setTimeout((function(){e.tip="检测超时",e.$dialog.confirm({message:"人脸采集超时，请重新采集"}).then((function(){e.reStart()})).catch((function(){e.$emit("update:openFaceVerify",!1)}))}),500);break;case"unsupported":e.tip="该浏览器不支持";break;case"notallowed":e.tip="相机权限被拒绝";break;case"notfound":e.tip="未找到相机";break;case"notreadable":e.tip="无法读取相机";break;case"overconstrained":e.tip="相机分辨率过低";break;case"abort":e.tip="相机无法使用";break;case"reject":e.tip="获取相机权限失败";break;case"auth":e.tip="认证不通过";break;case"pdFail":e.tip="炫瞳检测失败"}"timeout"!==e.tip&&e.deviceTip()}))},reStart:function(){var e=this;return Object(i.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.currentColorIdx=-1,e.actionIndex=0,e.bdFaceLiveDetection.setOptions({code:c().join("")}),t.next=5,e.bdFaceLiveDetection.restart();case 5:case"end":return t.stop()}}),t)})))()},fetchFaceSec:function(e){return Object(i.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case 1:case"end":return e.stop()}}),e)})))()}},updated:function(){},beforeDestroy:function(){this.bdFaceLiveDetection&&this.bdFaceLiveDetection.destroy(),this.timer&&clearTimeout(this.timer)}},a=(n("ae46"),n("2877"));r={name:"CheckFace",props:{},components:{"webrtc-face-verify":Object(a.a)(r,(function(){var e=this,t=e.$createElement;t=e._self._c||t;return t("div",{staticClass:"container"},[e.isSupported?t("div",{staticClass:"facePhoto"},[t("div",{staticClass:"center"},[t("div",{class:["tip",{running:e.colorRunning}]},[e._v(" "+e._s(e.tip)+" "),e.tip&&!e.colorRunning&&e.query.isAction?t("div",[e._v(" "+e._s(e.actionIndex+"/"+e.query.actionNumber)+" ")]):e._e()]),t("div",{staticClass:"ui-camera"},[t("div",{staticClass:"ui-camera-inner",attrs:{id:"videoParent"}},[t("video",{attrs:{id:"face-live-detection-video",playsinline:!0,autoplay:!0},domProps:{muted:!0}},[e._v(" Please update your browser. ")])])])]),0===e.currentColorIdx?t("div",{class:["circle","circle1"],style:{backgroundColor:e.currentColorValue}}):e._e(),1===e.currentColorIdx?t("div",{class:["circle","circle2"],style:{backgroundColor:e.currentColorValue}}):e._e(),2===e.currentColorIdx?t("div",{class:["circle","circle3"],style:{backgroundColor:e.currentColorValue}}):e._e()]):e._e()])}),[],!1,null,"ce412750",null).exports},data:function(){return{openFaceVerify:!1}},computed:{},watch:{},created:function(){this.setHeaderTitle("人脸识别")},mounted:function(){},methods:{test:function(){var e=this;return Object(i.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.Global.api.testModel();case 3:t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},notifyPhoto:function(){this.openFaceVerify=!0}},updated:function(){},beforeDestroy:function(){}},n("4ee0"),n=Object(a.a)(r,(function(){var e=this,t=e.$createElement;t=e._self._c||t;return t("div",{staticClass:"CheckFace"},[t("div",{staticClass:"open-face"},[t("van-button",{attrs:{type:"primary"},on:{click:e.notifyPhoto}},[e._v("开始人脸识别")])],1),e.openFaceVerify?t("webrtc-face-verify",{ref:"faceVerifyCtrl",attrs:{openFaceVerify:e.openFaceVerify},on:{"update:openFaceVerify":function(t){e.openFaceVerify=t},"update:open-face-verify":function(t){e.openFaceVerify=t}}}):e._e()],1)}),[],!1,null,"ad1d20f6",null);t.default=n.exports},ae46:function(e,t,n){"use strict";n("ef70")},ef70:function(e,t,n){}}]);