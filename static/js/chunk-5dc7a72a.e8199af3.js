(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5dc7a72a"],{"24eb":function(e,t,n){},4374:function(e,t,n){},"4ee0":function(e,t,n){"use strict";n("24eb")},aaa8:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"CheckFace"},[n("div",{staticClass:"open-face"},[n("van-button",{attrs:{type:"primary"},on:{click:e.notifyPhoto}},[e._v("开始人脸识别")])],1),e.openFaceVerify?n("webrtc-face-verify",{ref:"faceVerifyCtrl",attrs:{openFaceVerify:e.openFaceVerify},on:{"update:openFaceVerify":function(t){e.openFaceVerify=t},"update:open-face-verify":function(t){e.openFaceVerify=t}}}):e._e()],1)},i=[],c=n("1da1"),r=(n("96cf"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[e.isSupported?n("div",{staticClass:"facePhoto"},[n("div",{staticClass:"center"},[n("div",{class:["tip",{running:e.colorRunning}]},[e._v(" "+e._s(e.tip)+" "),e.tip&&!e.colorRunning&&e.query.isAction?n("div",[e._v(" "+e._s(e.actionIndex+"/"+e.query.actionNumber)+" ")]):e._e()]),n("div",{staticClass:"ui-camera"},[n("div",{staticClass:"ui-camera-inner",attrs:{id:"videoParent"}},[n("video",{attrs:{id:"face-live-detection-video",playsinline:!0,autoplay:!0},domProps:{muted:!0}},[e._v(" Please update your browser. ")])])])]),0===e.currentColorIdx?n("div",{class:["circle","circle1"],style:{backgroundColor:e.currentColorValue}}):e._e(),1===e.currentColorIdx?n("div",{class:["circle","circle2"],style:{backgroundColor:e.currentColorValue}}):e._e(),2===e.currentColorIdx?n("div",{class:["circle","circle3"],style:{backgroundColor:e.currentColorValue}}):e._e()]):e._e()])}),a=[],s=(n("caad"),n("a15b"),n("eee4")),u=["production","prod"].includes("production");function l(e,t){var n=new Array(t),o=e.length,i=new Array(o);if(t>o)throw new RangeError("getrandom: more elements taken than available");while(t--){var c=Math.floor(Math.random()*o);n[t]=e[c in i?i[c]:c],i[c]=--o in i?i[o]:o}return n}function d(){var e=[0,1,Math.floor(4*Math.random()+2)];return l(e,3)}console.log("code",d());var f={name:"FaceVerify",props:{},components:{},data:function(){return{tip:"",currentColorIdx:-1,currentColorValue:"transparent",actionIndex:0,bdFaceLiveDetection:null,image:"",isSupported:s["default"].isSupport(),query:{actionNumber:3,code:d().join(""),threshold:.8,isAction:!0},timer:null,risk:null,action:""}},computed:{colorRunning:function(){return-1!==this.currentColorIdx}},watch:{},created:function(){this.$toast.clear()},mounted:function(){var e=this;console.log("this.isSupported",this.isSupported),this.isSupported?this.$nextTick((function(){e.init(e.query)})):(this.tip="该浏览器不支持",this.deviceTip())},methods:{deviceTip:function(){this.$dialog.confirm({message:this.tip,showCancelButton:!1}).then((function(){console.log("关闭-不支持webrtc")})).catch((function(){console.log("关闭-不支持webrtc-catch")}))},init:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.bdFaceLiveDetection=new s["default"]({video:"face-live-detection-video",solutionType:2,code:e.code,randomMotionDetection:!1,needToRecord:!1,timeout:15e3,useSecure:!0,constraints:{video:{width:{min:320,ideal:320,max:320},height:{min:240,ideal:240,max:240}},audio:!1},isOriginImage:!1,modelPath:u?"./mobile-h5":".",autoloadModels:!1,vbox:[216,216],leftYaw:15,rightYaw:15,occlusion:{eye:.8,mouse:.8,nose:.8,leftFace:.8,rightFace:.8,chin:.8}}),console.log("this.bdFaceLiveDetection",t.bdFaceLiveDetection),t.bindEvents(),n.next=5,t.bdFaceLiveDetection.start();case 5:t.bdFaceLiveDetection.loadModels();case 6:case"end":return n.stop()}}),n)})))()},bindEvents:function(){var e=this;this.bdFaceLiveDetection.on("camera_open",(function(){console.log("camera_open"),e.tip="摄像头即将开启，请平视并正对屏幕"})),this.bdFaceLiveDetection.on("status",(function(e){console.log("status",e)})),this.bdFaceLiveDetection.on("detection:colorfinished",(function(){console.log("炫瞳活体检测完成1")})),this.bdFaceLiveDetection.on("detection:silencefinished",(function(){console.log("静默活体检测完成1")})),this.bdFaceLiveDetection.on("detection:actionfinished",(function(){console.log("活体动作完成")})),this.bdFaceLiveDetection.on("action",(function(t){console.log("action",t),e.actionIndex=t})),this.bdFaceLiveDetection.on("tip",(function(t){var n=t.code,o=t.text;console.log("code",n,"text",o),"action_over"!==n&&(["blink","lookup","lookdown","mouthopen","headleft","headright"].includes(n)&&(e.action=n+"2"),e.tip="undefined"===typeof o?"请平视并正对屏幕":o)})),this.bdFaceLiveDetection.on("color",(function(t,n){console.log("color",t,n),e.currentColorIdx=t,e.currentColorValue=n})),this.bdFaceLiveDetection.on("success",(function(t){if(console.log("success",t),e.tip="检测完成，正在进行系统验证",e.$toast.loading({message:"系统验证中",forbidClick:!1,loadingType:"spinner",duration:0}),t.face){var n={face:t.face,jr:t.jr};e.fetchFaceSec(n)}else console.log("fetchFaceLiveness - gg")})),this.bdFaceLiveDetection.on("fail",(function(t){var n=t[0];switch(console.log("fail",t,n),n){case"timeout":e.timer&&clearTimeout(e.timer),e.timer=setTimeout((function(){e.tip="检测超时",e.$dialog.confirm({message:"人脸采集超时，请重新采集"}).then((function(){console.log("采集超时"),e.reStart()})).catch((function(){console.log("采集超时-catch"),e.$emit("update:openFaceVerify",!1)}))}),500);break;case"unsupported":e.tip="该浏览器不支持";break;case"notallowed":e.tip="相机权限被拒绝";break;case"notfound":e.tip="未找到相机";break;case"notreadable":e.tip="无法读取相机";break;case"overconstrained":e.tip="相机分辨率过低";break;case"abort":e.tip="相机无法使用";break;case"reject":e.tip="获取相机权限失败";break;case"auth":e.tip="认证不通过";break;case"pdFail":e.tip="炫瞳检测失败";break;default:break}"timeout"!==e.tip&&e.deviceTip()}))},reStart:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.currentColorIdx=-1,e.actionIndex=0,e.bdFaceLiveDetection.setOptions({code:d().join("")}),t.next=5,e.bdFaceLiveDetection.restart();case 5:case"end":return t.stop()}}),t)})))()},fetchFaceSec:function(e){return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("******************",e);case 1:case"end":return t.stop()}}),t)})))()}},updated:function(){},beforeDestroy:function(){this.bdFaceLiveDetection&&this.bdFaceLiveDetection.destroy(),this.timer&&clearTimeout(this.timer)}},p=f,h=(n("e343"),n("2877")),v=Object(h["a"])(p,r,a,!1,null,"3a5e5578",null),m=v.exports,b={name:"CheckFace",props:{},components:{"webrtc-face-verify":m},data:function(){return{openFaceVerify:!1}},computed:{},watch:{},created:function(){this.setHeaderTitle("人脸识别")},mounted:function(){},methods:{test:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.Global.api.testModel();case 3:n=t.sent,console.log(n),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.log("test",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},notifyPhoto:function(){this.openFaceVerify=!0}},updated:function(){},beforeDestroy:function(){}},g=b,w=(n("4ee0"),Object(h["a"])(g,o,i,!1,null,"ad1d20f6",null));t["default"]=w.exports},e343:function(e,t,n){"use strict";n("4374")}}]);